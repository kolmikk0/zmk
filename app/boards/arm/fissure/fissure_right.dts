#include "fissure.dtsi"
#include "dt-bindings/zmk/is31fl3729_transform.h"
#include "fissure_right-pinctrl.dtsi"

&transform {
    row-offset = <4>;
};

/ {
    chosen {
    };
};

&i2c0 {
    compatible = "nordic,nrf-twi";
    status = "okay";
    pinctrl-0 = <&i2c0_def>;
    pinctrl-1 = <&i2c0_slp>;
    pinctrl-names = "default", "sleep";
	rgb: is31fl3729@34 {
        compatible = "issi,is31fl3729";
        status = "okay";
        reg = <0x34>;
        r-ext = <10>;
        led-max-current = <1>;
        sdb-gpios = <&gpio0 4 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>;
        chain-length = <60>;
        scaling = <BGR_SCALING BGR_SCALING BGR_SCALING BGR_SCALING BGR_SCALING 0>;

#define RGB_CS0 3, 2, 1
#define RGB_CS1 9, 8, 7
#define RGB_CS2 12, 11, 10
#define RGB_CS3 15, 14, 13
#define RGB_CS4 6, 5, 4
		map = <
PIX(1, 0) PIX(2, 0) PIX(3, 0) PIX(4, 0) PIX(4, 3) PIX(4, 3)
PIX(1, 1) PIX(2, 1) PIX(4, 4) PIX(4, 1) PIX(2, 3) PIX(3, 3) 
PIX(1, 2) PIX(2, 2) PIX(3, 1) PIX(3, 2) PIX(1, 3)
PIX(1, 4) PIX(2, 4) PIX(3, 4)
            >;
    };
};

&spi0 {
    compatible = "nordic,nrf-spim";
    status = "okay";
    pinctrl-0 = <&spi0_def>;
    pinctrl-1 = <&spi0_slp>;
    pinctrl-names = "default", "sleep";
    cs-gpios = <&gpio1 0 GPIO_ACTIVE_LOW>, <&gpio0 15 GPIO_ACTIVE_LOW>, <&gpio0 24 GPIO_ACTIVE_LOW>;
               // <&gpio0 8 GPIO_ACTIVE_LOW>;

    steno_flash: nor-flash@0 {
        reg = <0>;
        compatible = "jedec,spi-nor";
        status = "okay";
        sck-frequency = <8000000>;
        jedec-id = [20 ba 18];      // TODO
        size = <0x8000000>;
        has-dpd;
        t-enter-dpd = <3000>;
        t-exit-dpd = <30000>;
    };

    trackball: trackball@1 {
        compatible = "pixart,pmw3610";
        status = "okay";
        reg = <1>;
        spi-max-frequency = <2000000>;
        label = "pmw3610";
        irq-gpios = <&gpio0 10 GPIO_ACTIVE_LOW>;
        rst-gpios = <&gpio0 9 GPIO_ACTIVE_LOW>;
    };

    trackpad@2 {
        compatible = "cirque,pinnacle";
        status = "okay";
        label = "trackpad";
        reg = <2>;
        spi-max-frequency = <10000000>;
        dr-gpios = <&gpio0 13 GPIO_ACTIVE_HIGH>;
        rotate-90;
        sleep;
        /* no-taps; */
    };
};
